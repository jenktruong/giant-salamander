---
title: "Pacific Giant Salamander"
author: "Jennifer Truong & Joanne Pham"
date: "11/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      results = 'hide')
```

```{r}
# Attach packages

library(tidyverse)
library(janitor)
library(here)
library(kableExtra)
library(ggbeeswarm)
library(car)
library(ggridges)

# Read in Mack Creek Vertebrates.csv

mack_creek_df <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>%  # Change column names to lower case
  rename("channeltype" = "unittype") # Rename "unittype" column to "channeltype" for more clarity
```

## Introduction

## Data and Methods

"Old Growth" refers to the 500 year old coniferous forest upstream, while "Clear Cut" refers to the clear-cut section of the forest.

## Results

```{r}
# Data frame to pull for all results. 
mack_creek_data <- mack_creek_df %>% 
  select(entity, section, channeltype, weight, year)

# Note: Weights is in grams (from metadata)
```

### A. Annual Salamander Counts in Old Growth (OG) and Clear Cut (CC) Sections of Mack Creek

```{r}
# Counting for section (clear and old growth)

mack_creek_cc_og <- mack_creek_data %>% 
  group_by(section, year) %>% 
  summarize(counts = sum(entity)) 

```

```{r}
# Graph for changes in yearly salamander population in these two sections over time 

ggplot(data = mack_creek_cc_og, aes(x = year, y = counts)) +
  geom_line(aes(color = section), size = 1) +
  scale_x_continuous(lim = c(1987, 2017),
                     expand= c(0,0)) +
  labs(x = "Year", 
       y = "Salamander Counts",
       title = "Change in yearly giant salmander count from Mack Creek, 1987-2017") + 
  scale_color_manual(name = "Forest Sections",
                     labels = c("Clear Cut",
                                 "Old Growth"),
                     values = c("CC" = "darkolivegreen1",
                                "OG" = "darkgreen")) +
  theme_bw()

```


### B. Salamander Counts by Channel Classification

```{r}
# Clean data subset so that it only includes 2017 observations
mack_creek_weight_2017 <- mack_creek_data %>% 
  filter(year == 2017)

# Determining the counts of salamanders in different channel types in different forest sections for 2017

mack_creek_class_count <- mack_creek_weight_2017 %>% 
  filter(channeltype %in% c("C", "P", "SC")) %>% 
  count(channeltype, section)

mack_creek_class_table <- mack_creek_class_count %>% 
  pivot_wider(names_from = section, values_from = n)

```

```{r}
# Now finding the proportions
mc_props <- mack_creek_class_table %>% 
  janitor::adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front")

mc_props <- mc_props %>% 
  rename("Channel type" = channeltype,
         "Clear cut" = CC,
         "Original growth" = OG)
```




```


### C. Hypothesis Testing: Significant Difference in Location?

### D. Comparison of Salamander Weights in OG and CC Sections

```{r}
# Further filter subset so that it only considers creek section for now
mack_creek_weight_section <- mack_creek_weight_2017 %>% 
  select(-channeltype) # Remove channel column

<<<<<<< HEAD
# Create ridgeline plots and qq plots to see data distribution

# Ridgeline plots
ggplot(data = mack_creek_weight_section,
       aes(x = section, y = weight)) +
  geom_beeswarm(aes(color = section))
=======
# Find mean weight for the two sections
mc_weight_section_summary <- mack_creek_weight_section %>% 
  group_by(section) %>%  # Group by section
  summarize(
    mean_weight = mean(weight, na.rm = TRUE), # Find mean, remove NA values
    sd_weight = sd(weight, na.rm = TRUE), # Find standard deviation, remove NA values
    sample_size = n(), # We don't use count() because data is already grouped by section
    se_weight = sd_weight / sqrt(sample_size), # Find standard error
    var_weight = var(weight, na.rm = TRUE) # Find variance
  ) 

# Create beeswarm plots and qq plots to see data distribution

# Beeswarm plots

ggplot() + # Leave ggplot blank to graph from multiple data frames
  geom_beeswarm(data = mack_creek_weight_section, # Start beeswarm plot
                aes(x = section, 
                    y = weight,
                    color = section,
                    alpha = 0.5)) + # Change transparency to half
  scale_x_discrete(labels = c("Clear Cut", "Old Growth")) + # Rename x-axis labels
  geom_point(data = mc_weight_section_summary, # Graph points for mean weight
             aes(x = section, y = mean_weight),
             color = "red", # Color mean point red
             size = 1.5) + # Change size to 1.5
  geom_errorbar(data = mc_weight_section_summary, # Graph error bar for mean weight
                aes(x = section,
                    ymin = mean_weight - sd_weight,
                    ymax = mean_weight + sd_weight),
                width = 0.1,
                color = "red") + # Color them with same color as mean point
  theme_minimal()
  
>>>>>>> d9e180c5a76c0532a58fc3593bc53e8f69c75c13
```


### E. Comparison of Salamander Weights in Pools, Cascades, and Side Channels

```{r}
# Create another subset for considering channel type only
mack_creek_weight_channel <- mack_creek_weight_2017 %>% 
  select(-section) # Remove section column
```


## Summary

## References